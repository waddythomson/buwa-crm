---
import Layout from './Layout.astro';
import { getSession } from '../lib/auth';

interface Props {
  title: string;
}

const { title } = Astro.props;

// Check authentication
const user = await getSession(Astro.cookies);
if (!user) {
  return Astro.redirect('/login');
}
---

<Layout title={title}>
  <nav class="nav">
    <a href="/" class="nav-brand">BuWa CRM</a>
    <div class="nav-links">
      <a href="/contacts">Contacts</a>
      {user.role === 'admin' && <a href="/users">Users</a>}
      <a href="/logout">Logout</a>
    </div>
  </nav>
  <div class="container">
    <slot />
  </div>
</Layout>
